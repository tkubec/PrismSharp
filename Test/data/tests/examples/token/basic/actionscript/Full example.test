package {
  import flash.display.*;
  import flash.events.*;
  import flash.filters.BlurFilter;
  import flash.geom.*;
  import flash.ui.*;
  public class ch23ex2 extends Sprite {
    protected const BMP_SCALE:Number = 1/2;
    protected const D:Number = 1.015;
    protected const DIM_EFFECT:ColorTransform = new ColorTransform(D, D, D);
    protected const B:int = 16;
    protected const BLUR_EFFECT:BlurFilter = new BlurFilter(B, B, 1);
    protected var RLUT:Array, GLUT:Array, BLUT:Array;
    protected var sourceBmp:BitmapData;
    protected var colorBmp:BitmapData;
    protected var touches:Array = new Array();
    protected var fingerShape:Shape = new Shape();
    public function ch23ex2() {
      try {
        var test:Class = Multitouch;
        if (Multitouch.supportsTouchEvents) {
          Multitouch.inputMode = MultitouchInputMode.TOUCH_POINT;
          init();
        } else {
          trace("Sorry, this example requires multitouch.");
        }
      } catch (error:ReferenceError) {
        trace("Sorry, but multitouch is not supported in this runtime.");
      }
    }
    protected function init():void {
      //create a black-and-white bitmap and a color bitmap, only show the color
      sourceBmp = new BitmapData(
        stage.stageWidth*BMP_SCALE, stage.stageHeight*BMP_SCALE, false, 0);
      colorBmp = sourceBmp.clone();
      var bitmap:Bitmap = new Bitmap(colorBmp, PixelSnapping.ALWAYS, true);
      bitmap.width = stage.stageWidth; bitmap.height = stage.stageHeight;
      addChild(bitmap);

      //create finger shape to paste onto the bitmap under your touches
      fingerShape.graphics.beginFill(0xffffff, 0.1);
      fingerShape.graphics.drawEllipse(-15, -20, 30, 40);
      fingerShape.graphics.endFill();

      //create the palette map from a gradient
      var gradient:Shape = new Shape();
      var m:Matrix = new Matrix();
      m.createGradientBox(256, 10);
      gradient.graphics.beginGradientFill(GradientType.LINEAR,
        [0x313ad8, 0x2dce4a, 0xdae234, 0x7a1c1c, 0x0f0303],
        [1, 1, 1, 1, 1], [0, 0.4*256, 0.75*256, 0.9*256, 255], m);
      gradient.graphics.drawRect(0, 0, 256, 10);
      var gradientBmp:BitmapData = new BitmapData(256, 10, false, 0);
      gradientBmp.draw(gradient);
      RLUT = new Array(); GLUT = new Array(); BLUT = new Array();
      for (var i:int = 0; i < 256; i++) {
        var pixelColor:uint = gradientBmp.getPixel(i, 0);
        //I drew the gradient backwards, so sue me
        RLUT[256-i] = pixelColor & 0xff0000;
        GLUT[256-i] = pixelColor & 0x00ff00;
        BLUT[256-i] = pixelColor & 0x0000ff;
      }

      stage.addEventListener(TouchEvent.TOUCH_BEGIN, assignTouch);
      stage.addEventListener(TouchEvent.TOUCH_MOVE, assignTouch);
      stage.addEventListener(TouchEvent.TOUCH_END, removeTouch);
      stage.addEventListener(Event.ENTER_FRAME, onEnterFrame);
    }
    protected function assignTouch(event:TouchEvent):void {
      touches[event.touchPointID] = event;
    }
    protected function removeTouch(event:TouchEvent):void {
      delete touches[event.touchPointID];
    }
    protected function onEnterFrame(event:Event):void {
      for (var key:String in touches) {
        var touch:TouchEvent = touches[key] as TouchEvent;
        if (touch) {
          //plaster the finger image under your finger
          var m:Matrix = new Matrix();
          m.translate(touch.stageX*BMP_SCALE, touch.stageY*BMP_SCALE);
          sourceBmp.draw(fingerShape, m, null, BlendMode.ADD);
        }
      }
      var O:Point = new Point(0, 0);
      //blur and ever-so-slightly brighten the image to make the color last
      sourceBmp.applyFilter(sourceBmp, sourceBmp.rect, O, BLUR_EFFECT);
      sourceBmp.colorTransform(sourceBmp.rect, DIM_EFFECT);
      //we've calculated the image in grayscale brightnesses, now make it color
      colorBmp.paletteMap(sourceBmp, sourceBmp.rect, O, RLUT, GLUT, BLUT, null);
    }
  }
}
----------------------------------------------------
[
	["keyword", "package"],
	["punctuation", "{"],

	["keyword", "import"],
	" flash",
	["punctuation", "."],
	"display",
	["punctuation", "."],
	["operator", "*"],
	["punctuation", ";"],

	["keyword", "import"],
	" flash",
	["punctuation", "."],
	"events",
	["punctuation", "."],
	["operator", "*"],
	["punctuation", ";"],

	["keyword", "import"],
	" flash",
	["punctuation", "."],
	"filters",
	["punctuation", "."],
	"BlurFilter",
	["punctuation", ";"],

	["keyword", "import"],
	" flash",
	["punctuation", "."],
	"geom",
	["punctuation", "."],
	["operator", "*"],
	["punctuation", ";"],

	["keyword", "import"],
	" flash",
	["punctuation", "."],
	"ui",
	["punctuation", "."],
	["operator", "*"],
	["punctuation", ";"],

	["keyword", "public"],
	["keyword", "class"],
	["class-name", ["ch23ex2"]],
	["keyword", "extends"],
	["class-name", ["Sprite"]],
	["punctuation", "{"],

	["keyword", "protected"],
	["keyword", "const"],
	["constant", "BMP_SCALE"],
	["punctuation", ":"],
	"Number ",
	["operator", "="],
	["number", "1"],
	["operator", "/"],
	["number", "2"],
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "const"],
	["constant", "D"],
	["punctuation", ":"],
	"Number ",
	["operator", "="],
	["number", "1.015"],
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "const"],
	["constant", "DIM_EFFECT"],
	["punctuation", ":"],
	"ColorTransform ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["ColorTransform"]],
	["punctuation", "("],
	["constant", "D"],
	["punctuation", ","],
	["constant", "D"],
	["punctuation", ","],
	["constant", "D"],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "const"],
	["constant", "B"],
	["punctuation", ":"],
	"int ",
	["operator", "="],
	["number", "16"],
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "const"],
	["constant", "BLUR_EFFECT"],
	["punctuation", ":"],
	"BlurFilter ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["BlurFilter"]],
	["punctuation", "("],
	["constant", "B"],
	["punctuation", ","],
	["constant", "B"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "var"],
	["constant", "RLUT"],
	["punctuation", ":"],
	"Array",
	["punctuation", ","],
	["constant", "GLUT"],
	["punctuation", ":"],
	"Array",
	["punctuation", ","],
	["constant", "BLUT"],
	["punctuation", ":"],
	"Array",
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "var"],
	" sourceBmp",
	["punctuation", ":"],
	"BitmapData",
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "var"],
	" colorBmp",
	["punctuation", ":"],
	"BitmapData",
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "var"],
	" touches",
	["punctuation", ":"],
	"Array ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Array"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "protected"],
	["keyword", "var"],
	" fingerShape",
	["punctuation", ":"],
	"Shape ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Shape"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "public"],
	["keyword", "function"],
	["function", "ch23ex2"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "{"],

	["keyword", "try"],
	["punctuation", "{"],

	["keyword", "var"],
	" test",
	["punctuation", ":"],
	"Class ",
	["operator", "="],
	" Multitouch",
	["punctuation", ";"],

	["keyword", "if"],
	["punctuation", "("],
	"Multitouch",
	["punctuation", "."],
	"supportsTouchEvents",
	["punctuation", ")"],
	["punctuation", "{"],

	"\n          Multitouch",
	["punctuation", "."],
	"inputMode ",
	["operator", "="],
	" MultitouchInputMode",
	["punctuation", "."],
	["constant", "TOUCH_POINT"],
	["punctuation", ";"],

	["function", "init"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", "}"],
	["keyword", "else"],
	["punctuation", "{"],

	["function", "trace"],
	["punctuation", "("],
	["string", "\"Sorry, this example requires multitouch.\""],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", "}"],

	["punctuation", "}"],
	["keyword", "catch"],
	["punctuation", "("],
	"error",
	["punctuation", ":"],
	"ReferenceError",
	["punctuation", ")"],
	["punctuation", "{"],

	["function", "trace"],
	["punctuation", "("],
	["string", "\"Sorry, but multitouch is not supported in this runtime.\""],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", "}"],

	["punctuation", "}"],

	["keyword", "protected"],
	["keyword", "function"],
	["function", "init"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ":"],
	["keyword", "void"],
	["punctuation", "{"],

	["comment", "//create a black-and-white bitmap and a color bitmap, only show the color"],

	"\n      sourceBmp ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["BitmapData"]],
	["punctuation", "("],

	"\n        stage",
	["punctuation", "."],
	"stageWidth",
	["operator", "*"],
	["constant", "BMP_SCALE"],
	["punctuation", ","],
	" stage",
	["punctuation", "."],
	"stageHeight",
	["operator", "*"],
	["constant", "BMP_SCALE"],
	["punctuation", ","],
	["boolean", "false"],
	["punctuation", ","],
	["number", "0"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      colorBmp ",
	["operator", "="],
	" sourceBmp",
	["punctuation", "."],
	["function", "clone"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "var"],
	" bitmap",
	["punctuation", ":"],
	"Bitmap ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Bitmap"]],
	["punctuation", "("],
	"colorBmp",
	["punctuation", ","],
	" PixelSnapping",
	["punctuation", "."],
	["constant", "ALWAYS"],
	["punctuation", ","],
	["boolean", "true"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      bitmap",
	["punctuation", "."],
	"width ",
	["operator", "="],
	" stage",
	["punctuation", "."],
	"stageWidth",
	["punctuation", ";"],
	" bitmap",
	["punctuation", "."],
	"height ",
	["operator", "="],
	" stage",
	["punctuation", "."],
	"stageHeight",
	["punctuation", ";"],

	["function", "addChild"],
	["punctuation", "("],
	"bitmap",
	["punctuation", ")"],
	["punctuation", ";"],

	["comment", "//create finger shape to paste onto the bitmap under your touches"],

	"\n      fingerShape",
	["punctuation", "."],
	"graphics",
	["punctuation", "."],
	["function", "beginFill"],
	["punctuation", "("],
	["number", "0xffffff"],
	["punctuation", ","],
	["number", "0.1"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      fingerShape",
	["punctuation", "."],
	"graphics",
	["punctuation", "."],
	["function", "drawEllipse"],
	["punctuation", "("],
	["operator", "-"],
	["number", "15"],
	["punctuation", ","],
	["operator", "-"],
	["number", "20"],
	["punctuation", ","],
	["number", "30"],
	["punctuation", ","],
	["number", "40"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      fingerShape",
	["punctuation", "."],
	"graphics",
	["punctuation", "."],
	["function", "endFill"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["comment", "//create the palette map from a gradient"],

	["keyword", "var"],
	" gradient",
	["punctuation", ":"],
	"Shape ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Shape"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "var"],
	" m",
	["punctuation", ":"],
	"Matrix ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Matrix"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      m",
	["punctuation", "."],
	["function", "createGradientBox"],
	["punctuation", "("],
	["number", "256"],
	["punctuation", ","],
	["number", "10"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      gradient",
	["punctuation", "."],
	"graphics",
	["punctuation", "."],
	["function", "beginGradientFill"],
	["punctuation", "("],
	"GradientType",
	["punctuation", "."],
	["constant", "LINEAR"],
	["punctuation", ","],

	["punctuation", "["],
	["number", "0x313ad8"],
	["punctuation", ","],
	["number", "0x2dce4a"],
	["punctuation", ","],
	["number", "0xdae234"],
	["punctuation", ","],
	["number", "0x7a1c1c"],
	["punctuation", ","],
	["number", "0x0f0303"],
	["punctuation", "]"],
	["punctuation", ","],

	["punctuation", "["],
	["number", "1"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ","],
	["punctuation", "["],
	["number", "0"],
	["punctuation", ","],
	["number", "0.4"],
	["operator", "*"],
	["number", "256"],
	["punctuation", ","],
	["number", "0.75"],
	["operator", "*"],
	["number", "256"],
	["punctuation", ","],
	["number", "0.9"],
	["operator", "*"],
	["number", "256"],
	["punctuation", ","],
	["number", "255"],
	["punctuation", "]"],
	["punctuation", ","],
	" m",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      gradient",
	["punctuation", "."],
	"graphics",
	["punctuation", "."],
	["function", "drawRect"],
	["punctuation", "("],
	["number", "0"],
	["punctuation", ","],
	["number", "0"],
	["punctuation", ","],
	["number", "256"],
	["punctuation", ","],
	["number", "10"],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "var"],
	" gradientBmp",
	["punctuation", ":"],
	"BitmapData ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["BitmapData"]],
	["punctuation", "("],
	["number", "256"],
	["punctuation", ","],
	["number", "10"],
	["punctuation", ","],
	["boolean", "false"],
	["punctuation", ","],
	["number", "0"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      gradientBmp",
	["punctuation", "."],
	["function", "draw"],
	["punctuation", "("],
	"gradient",
	["punctuation", ")"],
	["punctuation", ";"],

	["constant", "RLUT"],
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Array"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],
	["constant", "GLUT"],
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Array"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],
	["constant", "BLUT"],
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Array"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "for"],
	["punctuation", "("],
	["keyword", "var"],
	" i",
	["punctuation", ":"],
	"int ",
	["operator", "="],
	["number", "0"],
	["punctuation", ";"],
	" i ",
	["operator", "<"],
	["number", "256"],
	["punctuation", ";"],
	" i",
	["operator", "++"],
	["punctuation", ")"],
	["punctuation", "{"],

	["keyword", "var"],
	" pixelColor",
	["punctuation", ":"],
	"uint ",
	["operator", "="],
	" gradientBmp",
	["punctuation", "."],
	["function", "getPixel"],
	["punctuation", "("],
	"i",
	["punctuation", ","],
	["number", "0"],
	["punctuation", ")"],
	["punctuation", ";"],

	["comment", "//I drew the gradient backwards, so sue me"],

	["constant", "RLUT"],
	["punctuation", "["],
	["number", "256"],
	["operator", "-"],
	"i",
	["punctuation", "]"],
	["operator", "="],
	" pixelColor ",
	["operator", "&"],
	["number", "0xff0000"],
	["punctuation", ";"],

	["constant", "GLUT"],
	["punctuation", "["],
	["number", "256"],
	["operator", "-"],
	"i",
	["punctuation", "]"],
	["operator", "="],
	" pixelColor ",
	["operator", "&"],
	["number", "0x00ff00"],
	["punctuation", ";"],

	["constant", "BLUT"],
	["punctuation", "["],
	["number", "256"],
	["operator", "-"],
	"i",
	["punctuation", "]"],
	["operator", "="],
	" pixelColor ",
	["operator", "&"],
	["number", "0x0000ff"],
	["punctuation", ";"],

	["punctuation", "}"],

	"\n\n      stage",
	["punctuation", "."],
	["function", "addEventListener"],
	["punctuation", "("],
	"TouchEvent",
	["punctuation", "."],
	["constant", "TOUCH_BEGIN"],
	["punctuation", ","],
	" assignTouch",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      stage",
	["punctuation", "."],
	["function", "addEventListener"],
	["punctuation", "("],
	"TouchEvent",
	["punctuation", "."],
	["constant", "TOUCH_MOVE"],
	["punctuation", ","],
	" assignTouch",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      stage",
	["punctuation", "."],
	["function", "addEventListener"],
	["punctuation", "("],
	"TouchEvent",
	["punctuation", "."],
	["constant", "TOUCH_END"],
	["punctuation", ","],
	" removeTouch",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      stage",
	["punctuation", "."],
	["function", "addEventListener"],
	["punctuation", "("],
	"Event",
	["punctuation", "."],
	["constant", "ENTER_FRAME"],
	["punctuation", ","],
	" onEnterFrame",
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", "}"],

	["keyword", "protected"],
	["keyword", "function"],
	["function", "assignTouch"],
	["punctuation", "("],
	"event",
	["punctuation", ":"],
	"TouchEvent",
	["punctuation", ")"],
	["punctuation", ":"],
	["keyword", "void"],
	["punctuation", "{"],

	"\n      touches",
	["punctuation", "["],
	"event",
	["punctuation", "."],
	"touchPointID",
	["punctuation", "]"],
	["operator", "="],
	" event",
	["punctuation", ";"],

	["punctuation", "}"],

	["keyword", "protected"],
	["keyword", "function"],
	["function", "removeTouch"],
	["punctuation", "("],
	"event",
	["punctuation", ":"],
	"TouchEvent",
	["punctuation", ")"],
	["punctuation", ":"],
	["keyword", "void"],
	["punctuation", "{"],

	["keyword", "delete"],
	" touches",
	["punctuation", "["],
	"event",
	["punctuation", "."],
	"touchPointID",
	["punctuation", "]"],
	["punctuation", ";"],

	["punctuation", "}"],

	["keyword", "protected"],
	["keyword", "function"],
	["function", "onEnterFrame"],
	["punctuation", "("],
	"event",
	["punctuation", ":"],
	"Event",
	["punctuation", ")"],
	["punctuation", ":"],
	["keyword", "void"],
	["punctuation", "{"],

	["keyword", "for"],
	["punctuation", "("],
	["keyword", "var"],
	" key",
	["punctuation", ":"],
	"String ",
	["keyword", "in"],
	" touches",
	["punctuation", ")"],
	["punctuation", "{"],

	["keyword", "var"],
	" touch",
	["punctuation", ":"],
	"TouchEvent ",
	["operator", "="],
	" touches",
	["punctuation", "["],
	"key",
	["punctuation", "]"],
	["keyword", "as"],
	" TouchEvent",
	["punctuation", ";"],

	["keyword", "if"],
	["punctuation", "("],
	"touch",
	["punctuation", ")"],
	["punctuation", "{"],

	["comment", "//plaster the finger image under your finger"],

	["keyword", "var"],
	" m",
	["punctuation", ":"],
	"Matrix ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Matrix"]],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n          m",
	["punctuation", "."],
	["function", "translate"],
	["punctuation", "("],
	"touch",
	["punctuation", "."],
	"stageX",
	["operator", "*"],
	["constant", "BMP_SCALE"],
	["punctuation", ","],
	" touch",
	["punctuation", "."],
	"stageY",
	["operator", "*"],
	["constant", "BMP_SCALE"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n          sourceBmp",
	["punctuation", "."],
	["function", "draw"],
	["punctuation", "("],
	"fingerShape",
	["punctuation", ","],
	" m",
	["punctuation", ","],
	["keyword", "null"],
	["punctuation", ","],
	" BlendMode",
	["punctuation", "."],
	["constant", "ADD"],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", "}"],

	["punctuation", "}"],

	["keyword", "var"],
	["constant", "O"],
	["punctuation", ":"],
	"Point ",
	["operator", "="],
	["keyword", "new"],
	["class-name", ["Point"]],
	["punctuation", "("],
	["number", "0"],
	["punctuation", ","],
	["number", "0"],
	["punctuation", ")"],
	["punctuation", ";"],

	["comment", "//blur and ever-so-slightly brighten the image to make the color last"],

	"\n      sourceBmp",
	["punctuation", "."],
	["function", "applyFilter"],
	["punctuation", "("],
	"sourceBmp",
	["punctuation", ","],
	" sourceBmp",
	["punctuation", "."],
	"rect",
	["punctuation", ","],
	["constant", "O"],
	["punctuation", ","],
	["constant", "BLUR_EFFECT"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n      sourceBmp",
	["punctuation", "."],
	["function", "colorTransform"],
	["punctuation", "("],
	"sourceBmp",
	["punctuation", "."],
	"rect",
	["punctuation", ","],
	["constant", "DIM_EFFECT"],
	["punctuation", ")"],
	["punctuation", ";"],

	["comment", "//we've calculated the image in grayscale brightnesses, now make it color"],

	"\n      colorBmp",
	["punctuation", "."],
	["function", "paletteMap"],
	["punctuation", "("],
	"sourceBmp",
	["punctuation", ","],
	" sourceBmp",
	["punctuation", "."],
	"rect",
	["punctuation", ","],
	["constant", "O"],
	["punctuation", ","],
	["constant", "RLUT"],
	["punctuation", ","],
	["constant", "GLUT"],
	["punctuation", ","],
	["constant", "BLUT"],
	["punctuation", ","],
	["keyword", "null"],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", "}"],

	["punctuation", "}"],

	["punctuation", "}"]
]

----------------------------------------------------