///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2019, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область СлужебныеПроцедурыИФункции

////////////////////////////////////////////////////////////////////////////////
//  Основные процедуры и функции поиска контактов.

// Получает представление и всю контактную информацию контакта.
//
// Параметры:
//  Контакт                 - ОпределяемыйТип.КонтактВзаимодействия - контакт для которого получается информация.
//  Представление           - Строка - в данный параметр будет помещено полученное представление.
//  СтрокаКИ                - Строка - в данный параметр будет помещено полученная контактная информация.
//  ТипКонтактнойИнформации - Перечисления.ТипыКонтактнойИнформации - возможность установить отбор по типу получаемой
//                                                                    контактной информации.
//
Процедура ПредставлениеИВсяКонтактнаяИнформациюКонтакта(Контакт, Представление, СтрокаКИ,ТипКонтактнойИнформации = Неопределено) Экспорт
	
	Представление = "";
	СтрокаКИ = "";
	Если Не ЗначениеЗаполнено(Контакт) 
		ИЛИ ТипЗнч(Контакт) = Тип("СправочникСсылка.СтроковыеКонтактыВзаимодействий") Тогда
		Контакт = Неопределено;
		Возврат;
	КонецЕсли;
	
	ИмяТаблицы = Контакт.Метаданные().Имя;
	ИмяПоляДляНаименованияВладельца = Взаимодействия.ИмяПоляДляНаименованияВладельца(ИмяТаблицы);
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СправочникКонтакт.Наименование          КАК Наименование,
	|	" + ИмяПоляДляНаименованияВладельца + " КАК НаименованиеВладельца
	|ИЗ
	|	Справочник." + ИмяТаблицы + " КАК СправочникКонтакт
	|ГДЕ
	|	СправочникКонтакт.Ссылка = &Контакт
	|";
	
	Запрос.УстановитьПараметр("Контакт", Контакт);
	Запрос.УстановитьПараметр("ТипКонтактнойИнформации", ТипКонтактнойИнформации);
	Выборка = Запрос.Выполнить().Выбрать();
	Если Не Выборка.Следующий() Тогда
		Возврат;
	КонецЕсли;
	
	Представление = Выборка.Наименование;
	
	Если Не ПустаяСтрока(Выборка.НаименованиеВладельца) Тогда
		Представление = Представление + " (" + Выборка.НаименованиеВладельца + ")";
	КонецЕсли;
	
	МассивКонтактов = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Контакт);
	ТаблицаКИ = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъектов(МассивКонтактов, ТипКонтактнойИнформации, Неопределено, ТекущаяДатаСеанса());
	
	Для Каждого СтрокаТаблицы Из ТаблицаКИ Цикл
		Если СтрокаТаблицы.Тип <> Перечисления.ТипыКонтактнойИнформации.Другое Тогда
			СтрокаКИ = СтрокаКИ + ?(ПустаяСтрока(СтрокаКИ), "", "; ") + СтрокаТаблицы.Представление;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Получает наименование и адреса электронной почты контакта.
//
// Параметры:
//  Контакт - Ссылка - контакт, для которого получаются данные.
//
// Возвращаемое значение:
//  Структура - содержит наименование контакта и список значений электронной почты контакта.
//
Функция НаименованиеИАдресаЭлектроннойПочтыКонтакта(Контакт) Экспорт
	
	Если Не ЗначениеЗаполнено(Контакт) 
		Или ТипЗнч(Контакт) = Тип("СправочникСсылка.СтроковыеКонтактыВзаимодействий") Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	МетаданныеКонтакта = Контакт.Метаданные();
	
	Если МетаданныеКонтакта.Иерархический Тогда
		Если Контакт.ЭтоГруппа Тогда
			Возврат Неопределено;
		КонецЕсли;
	КонецЕсли;
	
	МассивОписанияТиповКонтактов = ВзаимодействияКлиентСервер.ОписанияКонтактов();
	ЭлементМассиваОписания = Неопределено;
	Для Каждого ЭлементМассива Из МассивОписанияТиповКонтактов Цикл
		
		Если ЭлементМассива.Имя = МетаданныеКонтакта.Имя Тогда
			ЭлементМассиваОписания = ЭлементМассива;
			Прервать;
		КонецЕсли;
		
	КонецЦикла;
	
	Если ЭлементМассиваОписания = Неопределено Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	ИмяТаблицы = МетаданныеКонтакта.ПолноеИмя();
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ЕСТЬNULL(ТаблицаКонтактнаяИнформация.АдресЭП,"""") КАК АдресЭП,
	|	СправочникКонтакт." + ЭлементМассиваОписания.ИмяРеквизитаПредставлениеКонтакта + " КАК Наименование
	|ИЗ
	|	" + ИмяТаблицы + " КАК СправочникКонтакт
	|		ЛЕВОЕ СОЕДИНЕНИЕ " + ИмяТаблицы + ".КонтактнаяИнформация КАК ТаблицаКонтактнаяИнформация
	|		ПО (ТаблицаКонтактнаяИнформация.Ссылка = СправочникКонтакт.Ссылка)
	|			И (ТаблицаКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
	|ГДЕ
	|	СправочникКонтакт.Ссылка = &Контакт
	|ИТОГИ ПО
	|	Наименование";
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("Контакт", Контакт);
	Выборка = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Если Не Выборка.Следующий() Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Адреса = Новый Структура("Наименование,Адреса", Выборка.Наименование, Новый СписокЗначений);
	ВыборкаАдреса = Выборка.Выбрать();
	Пока ВыборкаАдреса.Следующий() Цикл
		Адреса.Адреса.Добавить(ВыборкаАдреса.АдресЭП);
	КонецЦикла;
	
	Возврат Адреса;
	
КонецФункции

// Получает адреса электронной почты контакта.
//
// Параметры:
//  Контакт - ОпределяемыйТип.КонтактВзаимодействия - контакт, для которого получаются данные.
//
// Возвращаемое значение:
//  Массив - массив структур содержащих адреса, виды и представления адресов.
//
Функция ПолучитьАдресаЭлектроннойПочтыКонтакта(Контакт, ВключатьНезаполненныеВиды = Ложь) Экспорт
	
	Если Не ЗначениеЗаполнено(Контакт) Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	ИмяМетаданныхКонтакта = Контакт.Метаданные().Имя;
	
	Если ВключатьНезаполненныеВиды Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ВидыКонтактнойИнформации.Ссылка КАК Вид,
		|	ВидыКонтактнойИнформации.Наименование КАК ВидНаименование,
		|	Контакты.Ссылка КАК Контакт
		|ПОМЕСТИТЬ КонтактВидыКИ
		|ИЗ
		|	Справочник.ВидыКонтактнойИнформации КАК ВидыКонтактнойИнформации,
		|	Справочник." + ИмяМетаданныхКонтакта + " КАК Контакты
		|ГДЕ
		|	ВидыКонтактнойИнформации.Родитель = &ГруппаВидаКонтактнойИнформации
		|	И Контакты.Ссылка = &Контакт
		|	И ВидыКонтактнойИнформации.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Представление(КонтактВидыКИ.Контакт) КАК Представление,
		|	ЕСТЬNULL(КонтактнаяИнформация.АдресЭП, """") КАК АдресЭП,
		|	КонтактВидыКИ.Вид,
		|	КонтактВидыКИ.ВидНаименование
		|ИЗ
		|	КонтактВидыКИ КАК КонтактВидыКИ
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник." + ИмяМетаданныхКонтакта + ".КонтактнаяИнформация КАК КонтактнаяИнформация
		|		ПО (КонтактнаяИнформация.Ссылка = КонтактВидыКИ.Контакт)
		|			И (КонтактнаяИнформация.Вид = КонтактВидыКИ.Вид)";
		
		ГруппаВидаКонтактнойИнформации = УправлениеКонтактнойИнформацией.ВидКонтактнойИнформацииПоИмени("Справочник" + ИмяМетаданныхКонтакта);
		Запрос.УстановитьПараметр("ГруппаВидаКонтактнойИнформации", ГруппаВидаКонтактнойИнформации);
	Иначе
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Таблицы.АдресЭП,
		|	Таблицы.Вид,
		|	Таблицы.Представление,
		|	Таблицы.Вид.Наименование КАК ВидНаименование
		|ИЗ
		|	Справочник." + ИмяМетаданныхКонтакта + ".КонтактнаяИнформация КАК Таблицы
		|ГДЕ
		|	Таблицы.Ссылка = &Контакт
		|	И Таблицы.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты)";
		
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Контакт", Контакт);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Количество() = 0 Тогда
		Возврат Новый Массив;
	КонецЕсли;
	
	Результат = Новый Массив;
	Пока Выборка.Следующий() Цикл
		Адрес = Новый Структура;
		Адрес.Вставить("АдресЭП",         Выборка.АдресЭП);
		Адрес.Вставить("Вид",             Выборка.Вид);
		Адрес.Вставить("Представление",   Выборка.Представление);
		Адрес.Вставить("ВидНаименование", Выборка.ВидНаименование);
		Результат.Добавить(Адрес);
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

Функция ОтправитьПолучитьПочтуПользователяВФоне(УникальныйИдентификатор) Экспорт
	
	ПараметрыПроцедуры = Новый Структура;
	
	ПараметрыВыполнения = ДлительныеОперации.ПараметрыВыполненияВФоне(УникальныйИдентификатор);
	ПараметрыВыполнения.НаименованиеФоновогоЗадания = НСтр("ru = 'Получение и отправка электронной почты пользователя'");
	
	ДлительнаяОперация = ДлительныеОперации.ВыполнитьВФоне("УправлениеЭлектроннойПочтой.ОтправитьЗагрузитьПочтуПользователя",
		ПараметрыПроцедуры,	ПараметрыВыполнения);
	Возврат ДлительнаяОперация;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
//  Прочее

// Устанавливает предмет для массива взаимодействий.
//
// Параметры:
//  МассивВзаимодействий - Массив - массив взаимодействий для которых будет установлен предмет.
//  Предмет  - Ссылка - предмет, на который будет выполнена замена.
//  ПроверятьНаличиеДругихЦепочек - Булево - если Истина, то будет выполнена замена предмета и для взаимодействий,
//                                           которые входят в  цепочки взаимодействий первым взаимодействием которых
//                                           является взаимодействие входящее в массив.
//
Процедура УстановитьПредметДляМассиваВзаимодействий(МассивВзаимодействий, Предмет, ПроверятьНаличиеДругихЦепочек = Ложь) Экспорт

	Если ПроверятьНаличиеДругихЦепочек Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПредметыВзаимодействий.Взаимодействие КАК Ссылка
		|ИЗ
		|	РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыВзаимодействий
		|ГДЕ
		|	НЕ (НЕ ПредметыВзаимодействий.Предмет В (&МассивВзаимодействий)
		|			И НЕ ПредметыВзаимодействий.Взаимодействие В (&МассивВзаимодействий))";
		
		Запрос.УстановитьПараметр("МассивВзаимодействий", МассивВзаимодействий);
		МассивВзаимодействий = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
		
	КонецЕсли;
	
	НачатьТранзакцию();
	Попытка
		Блокировка = Новый БлокировкаДанных;
		РегистрыСведений.ПредметыПапкиВзаимодействий.ЗаблокироватьПредметыПапокВзаимодействий(Блокировка, МассивВзаимодействий);
		Блокировка.Заблокировать();
		
		Если ТипЗнч(Предмет) = Тип("РегистрСведенийКлючЗаписи.СостоянияПредметовВзаимодействий") Тогда
			Предмет = Предмет.Предмет;
		КонецЕсли;
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПредметыПапкиВзаимодействий.Предмет
		|ИЗ
		|	РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
		|ГДЕ
		|	ПредметыПапкиВзаимодействий.Взаимодействие В(&МассивВзаимодействий)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	&Предмет";
		
		Запрос.УстановитьПараметр("Предмет", Предмет);
		Запрос.УстановитьПараметр("МассивВзаимодействий", МассивВзаимодействий);
		
		ВыборкаПредметы = Запрос.Выполнить().Выбрать();
		
		Для Каждого Взаимодействие Из МассивВзаимодействий Цикл
			Взаимодействия.УстановитьПредмет(Взаимодействие, Предмет, Ложь);
		КонецЦикла;
		
		Взаимодействия.РассчитатьРассмотреноПоПредметам(Взаимодействия.ТаблицаДанныхДляРасчетаРассмотрено(ВыборкаПредметы, "Предмет"));
		ЗафиксироватьТранзакцию();
	Исключение
		ОтменитьТранзакцию();
		ВызватьИсключение;
	КонецПопытки;	
КонецПроцедуры

// Преобразует письмо в двоичные данные и подготавливает к сохранению на диск.
//
// Параметры:
//  Письмо                  - ДокументСсылка.ЭлектронноеПисьмоВходящее,
//                            ДокументСсылка.ЭлектронноеПисьмоИсходящее - письмо, которое подготавливается к сохранению.
//  УникальныйИдентификатор - УникальныйИдентификатор - уникальный идентификатор формы, из которой была вызвана команда сохранения.
//
// Возвращаемое значение:
//  Структура - структура, содержащая подготовленные данные письма.
//
Функция ДанныеПисьмаДляСохраненияКакФайл(Письмо, УникальныйИдентификатор) Экспорт

	ДанныеФайла = СтруктураДанныхФайла();
	
	ДанныеПисьма = Взаимодействия.ИнтернетПочтовоеСообщениеИзПисьма(Письмо);
	Если ДанныеПисьма <> Неопределено Тогда
		
		ДвоичныеДанные = ДанныеПисьма.ИнтернетПочтовоеСообщение.ПолучитьИсходныеДанные();
		ДанныеФайла.СсылкаНаДвоичныеДанныеФайла = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);

		ДанныеФайла.Наименование = Взаимодействия.ПредставлениеПисьма(ДанныеПисьма.ИнтернетПочтовоеСообщение.Тема,
			ДанныеПисьма.ДатаПисьма);
		
		ДанныеФайла.Расширение  = "eml";
		ДанныеФайла.ИмяФайла    = ДанныеФайла.Наименование + "." + ДанныеФайла.Расширение;
		ДанныеФайла.Размер      = ДвоичныеДанные.Размер();
		ПапкаДляСохранитьКак = ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить("НастройкиПрограммы", "ПапкаДляСохранитьКак");
		ДанныеФайла.Вставить("ПапкаДляСохранитьКак", ПапкаДляСохранитьКак);
		ДанныеФайла.ДатаМодификацииУниверсальная = ТекущаяДатаСеанса();
		ДанныеФайла.ПолноеНаименованиеВерсии = ДанныеФайла.ИмяФайла;
		
	КонецЕсли;
	
	Возврат ДанныеФайла;

КонецФункции

Функция СтруктураДанныхФайла()

	СтруктураДанныхФайла = Новый Структура;
	СтруктураДанныхФайла.Вставить("СсылкаНаДвоичныеДанныеФайла",        "");
	СтруктураДанныхФайла.Вставить("ОтносительныйПуть",                  "");
	СтруктураДанныхФайла.Вставить("ДатаМодификацииУниверсальная",       Дата(1, 1, 1));
	СтруктураДанныхФайла.Вставить("ИмяФайла",                           "");
	СтруктураДанныхФайла.Вставить("Наименование",                       "");
	СтруктураДанныхФайла.Вставить("Расширение",                         "");
	СтруктураДанныхФайла.Вставить("Размер",                             "");
	СтруктураДанныхФайла.Вставить("Редактирует",                        Неопределено);
	СтруктураДанныхФайла.Вставить("ПодписанЭП",                         Ложь);
	СтруктураДанныхФайла.Вставить("Зашифрован",                         Ложь);
	СтруктураДанныхФайла.Вставить("ФайлРедактируется",                  Ложь);
	СтруктураДанныхФайла.Вставить("ФайлРедактируетТекущийПользователь", Ложь);
	СтруктураДанныхФайла.Вставить("ПолноеНаименованиеВерсии",           "");
	
	Возврат СтруктураДанныхФайла;

КонецФункции 

#КонецОбласти
----------------------------------------------------
[
	["comment", "///////////////////////////////////////////////////////////////////////////////////////////////////////"],
	["comment", "// Copyright (c) 2019, ООО 1С-Софт"],
	["comment", "// Все права защищены. Эта программа и сопроводительные материалы предоставляются "],
	["comment", "// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)"],
	["comment", "// Текст лицензии доступен по ссылке:"],
	["comment", "// https://creativecommons.org/licenses/by/4.0/legalcode"],
	["comment", "///////////////////////////////////////////////////////////////////////////////////////////////////////"],

	["directive", "#Область СлужебныеПроцедурыИФункции"],

	["comment", "////////////////////////////////////////////////////////////////////////////////"],
	["comment", "//  Основные процедуры и функции поиска контактов."],

	["comment", "// Получает представление и всю контактную информацию контакта."],

	["comment", "//"],

	["comment", "// Параметры:"],

	["comment", "//  Контакт                 - ОпределяемыйТип.КонтактВзаимодействия - контакт для которого получается информация."],

	["comment", "//  Представление           - Строка - в данный параметр будет помещено полученное представление."],

	["comment", "//  СтрокаКИ                - Строка - в данный параметр будет помещено полученная контактная информация."],

	["comment", "//  ТипКонтактнойИнформации - Перечисления.ТипыКонтактнойИнформации - возможность установить отбор по типу получаемой"],

	["comment", "//                                                                    контактной информации."],

	["comment", "//"],

	["keyword", "Процедура"],
	" ПредставлениеИВсяКонтактнаяИнформациюКонтакта",
	["punctuation", "("],
	"Контакт",
	["punctuation", ","],
	" Представление",
	["punctuation", ","],
	" СтрокаКИ",
	["punctuation", ","],
	"ТипКонтактнойИнформации ",
	["operator", "="],
	["keyword", "Неопределено"],
	["punctuation", ")"],
	["keyword", "Экспорт"],

	"\n\t\n\tПредставление ",
	["operator", "="],
	["string", "\"\""],
	["punctuation", ";"],

	"\n\tСтрокаКИ ",
	["operator", "="],
	["string", "\"\""],
	["punctuation", ";"],

	["keyword", "Если"],
	["operator", "Не"],
	" ЗначениеЗаполнено",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],

	["operator", "ИЛИ"],
	" ТипЗнч",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],
	["operator", "="],
	" Тип",
	["punctuation", "("],
	["string", "\"СправочникСсылка.СтроковыеКонтактыВзаимодействий\""],
	["punctuation", ")"],
	["keyword", "Тогда"],

	"\n\t\tКонтакт ",
	["operator", "="],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "Возврат"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tИмяТаблицы ",
	["operator", "="],
	" Контакт",
	["punctuation", "."],
	"Метаданные",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Имя",
	["punctuation", ";"],

	"\n\tИмяПоляДляНаименованияВладельца ",
	["operator", "="],
	" Взаимодействия",
	["punctuation", "."],
	"ИмяПоляДляНаименованияВладельца",
	["punctuation", "("],
	"ИмяТаблицы",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\n\tЗапрос ",
	["operator", "="],
	["keyword", "Новый"],
	" Запрос",
	["punctuation", ";"],

	"\n\tЗапрос",
	["punctuation", "."],
	"Текст ",
	["operator", "="],

	["string", "\"ВЫБРАТЬ\n\t|\tСправочникКонтакт.Наименование          КАК Наименование,\n\t|\t\""],
	["operator", "+"],
	" ИмяПоляДляНаименованияВладельца ",
	["operator", "+"],
	["string", "\" КАК НаименованиеВладельца\n\t|ИЗ\n\t|\tСправочник.\""],
	["operator", "+"],
	" ИмяТаблицы ",
	["operator", "+"],
	["string", "\" КАК СправочникКонтакт\n\t|ГДЕ\n\t|\tСправочникКонтакт.Ссылка = &Контакт\n\t|\""],
	["punctuation", ";"],

	"\n\t\n\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"Контакт\""],
	["punctuation", ","],
	" Контакт",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"ТипКонтактнойИнформации\""],
	["punctuation", ","],
	" ТипКонтактнойИнформации",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tВыборка ",
	["operator", "="],
	" Запрос",
	["punctuation", "."],
	["keyword", "Выполнить"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Выбрать",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Если"],
	["operator", "Не"],
	" Выборка",
	["punctuation", "."],
	"Следующий",
	["punctuation", "("],
	["punctuation", ")"],
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tПредставление ",
	["operator", "="],
	" Выборка",
	["punctuation", "."],
	"Наименование",
	["punctuation", ";"],

	["keyword", "Если"],
	["operator", "Не"],
	" ПустаяСтрока",
	["punctuation", "("],
	"Выборка",
	["punctuation", "."],
	"НаименованиеВладельца",
	["punctuation", ")"],
	["keyword", "Тогда"],

	"\n\t\tПредставление ",
	["operator", "="],
	" Представление ",
	["operator", "+"],
	["string", "\" (\""],
	["operator", "+"],
	" Выборка",
	["punctuation", "."],
	"НаименованиеВладельца ",
	["operator", "+"],
	["string", "\")\""],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tМассивКонтактов ",
	["operator", "="],
	" ОбщегоНазначенияКлиентСервер",
	["punctuation", "."],
	"ЗначениеВМассиве",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tТаблицаКИ ",
	["operator", "="],
	" УправлениеКонтактнойИнформацией",
	["punctuation", "."],
	"КонтактнаяИнформацияОбъектов",
	["punctuation", "("],
	"МассивКонтактов",
	["punctuation", ","],
	" ТипКонтактнойИнформации",
	["punctuation", ","],
	["keyword", "Неопределено"],
	["punctuation", ","],
	" ТекущаяДатаСеанса",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Для"],
	["keyword", "Каждого"],
	" СтрокаТаблицы ",
	["keyword", "Из"],
	" ТаблицаКИ ",
	["keyword", "Цикл"],

	["keyword", "Если"],
	" СтрокаТаблицы",
	["punctuation", "."],
	"Тип ",
	["operator", "<"],
	["operator", ">"],
	" Перечисления",
	["punctuation", "."],
	"ТипыКонтактнойИнформации",
	["punctuation", "."],
	"Другое ",
	["keyword", "Тогда"],

	"\n\t\t\tСтрокаКИ ",
	["operator", "="],
	" СтрокаКИ ",
	["operator", "+"],
	" ?",
	["punctuation", "("],
	"ПустаяСтрока",
	["punctuation", "("],
	"СтрокаКИ",
	["punctuation", ")"],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ","],
	["string", "\"; \""],
	["punctuation", ")"],
	["operator", "+"],
	" СтрокаТаблицы",
	["punctuation", "."],
	"Представление",
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	["keyword", "КонецЦикла"],
	["punctuation", ";"],

	["keyword", "КонецПроцедуры"],

	["comment", "// Получает наименование и адреса электронной почты контакта."],
	["comment", "//"],
	["comment", "// Параметры:"],
	["comment", "//  Контакт - Ссылка - контакт, для которого получаются данные."],
	["comment", "//"],
	["comment", "// Возвращаемое значение:"],
	["comment", "//  Структура - содержит наименование контакта и список значений электронной почты контакта."],
	["comment", "//"],
	["keyword", "Функция"],
	" НаименованиеИАдресаЭлектроннойПочтыКонтакта",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],
	["keyword", "Экспорт"],

	["keyword", "Если"],
	["operator", "Не"],
	" ЗначениеЗаполнено",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],

	["operator", "Или"],
	" ТипЗнч",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],
	["operator", "="],
	" Тип",
	["punctuation", "("],
	["string", "\"СправочникСсылка.СтроковыеКонтактыВзаимодействий\""],
	["punctuation", ")"],
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tМетаданныеКонтакта ",
	["operator", "="],
	" Контакт",
	["punctuation", "."],
	"Метаданные",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Если"],
	" МетаданныеКонтакта",
	["punctuation", "."],
	"Иерархический ",
	["keyword", "Тогда"],

	["keyword", "Если"],
	" Контакт",
	["punctuation", "."],
	"ЭтоГруппа ",
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tМассивОписанияТиповКонтактов ",
	["operator", "="],
	" ВзаимодействияКлиентСервер",
	["punctuation", "."],
	"ОписанияКонтактов",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tЭлементМассиваОписания ",
	["operator", "="],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "Для"],
	["keyword", "Каждого"],
	" ЭлементМассива ",
	["keyword", "Из"],
	" МассивОписанияТиповКонтактов ",
	["keyword", "Цикл"],

	["keyword", "Если"],
	" ЭлементМассива",
	["punctuation", "."],
	"Имя ",
	["operator", "="],
	" МетаданныеКонтакта",
	["punctuation", "."],
	"Имя ",
	["keyword", "Тогда"],

	"\n\t\t\tЭлементМассиваОписания ",
	["operator", "="],
	" ЭлементМассива",
	["punctuation", ";"],

	["keyword", "Прервать"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	["keyword", "КонецЦикла"], ["punctuation", ";"],

	["keyword", "Если"],
	" ЭлементМассиваОписания ",
	["operator", "="],
	["keyword", "Неопределено"],
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tИмяТаблицы ",
	["operator", "="],
	" МетаданныеКонтакта",
	["punctuation", "."],
	"ПолноеИмя",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\n\tТекстЗапроса ",
	["operator", "="],

	["string", "\"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ\n\t|\tЕСТЬNULL(ТаблицаКонтактнаяИнформация.АдресЭП,\"\"\"\") КАК АдресЭП,\n\t|\tСправочникКонтакт.\""],
	["operator", "+"],
	" ЭлементМассиваОписания",
	["punctuation", "."],
	"ИмяРеквизитаПредставлениеКонтакта ",
	["operator", "+"],
	["string", "\" КАК Наименование\n\t|ИЗ\n\t|\t\""],
	["operator", "+"],
	" ИмяТаблицы ",
	["operator", "+"],
	["string", "\" КАК СправочникКонтакт\n\t|\t\tЛЕВОЕ СОЕДИНЕНИЕ \""],
	["operator", "+"],
	" ИмяТаблицы ",
	["operator", "+"],
	["string", "\".КонтактнаяИнформация КАК ТаблицаКонтактнаяИнформация\n\t|\t\tПО (ТаблицаКонтактнаяИнформация.Ссылка = СправочникКонтакт.Ссылка)\n\t|\t\t\tИ (ТаблицаКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))\n\t|ГДЕ\n\t|\tСправочникКонтакт.Ссылка = &Контакт\n\t|ИТОГИ ПО\n\t|\tНаименование\""],
	["punctuation", ";"],

	"\n\t\n\tЗапрос ",
	["operator", "="],
	["keyword", "Новый"],
	" Запрос",
	["punctuation", ";"],

	"\n\tЗапрос",
	["punctuation", "."],
	"Текст ",
	["operator", "="],
	" ТекстЗапроса",
	["punctuation", ";"],

	"\n\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"Контакт\""],
	["punctuation", ","],
	" Контакт",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tВыборка ",
	["operator", "="],
	" Запрос",
	["punctuation", "."],
	["keyword", "Выполнить"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Выбрать",
	["punctuation", "("],
	"ОбходРезультатаЗапроса",
	["punctuation", "."],
	"ПоГруппировкам",
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Если"],
	["operator", "Не"],
	" Выборка",
	["punctuation", "."],
	"Следующий",
	["punctuation", "("],
	["punctuation", ")"],
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tАдреса ",
	["operator", "="],
	["keyword", "Новый"],
	" Структура",
	["punctuation", "("],
	["string", "\"Наименование,Адреса\""],
	["punctuation", ","],
	" Выборка",
	["punctuation", "."],
	"Наименование",
	["punctuation", ","],
	["keyword", "Новый"],
	" СписокЗначений",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tВыборкаАдреса ",
	["operator", "="],
	" Выборка",
	["punctuation", "."],
	"Выбрать",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Пока"],
	" ВыборкаАдреса",
	["punctuation", "."],
	"Следующий",
	["punctuation", "("],
	["punctuation", ")"],
	["keyword", "Цикл"],

	"\n\t\tАдреса",
	["punctuation", "."],
	"Адреса",
	["punctuation", "."],
	"Добавить",
	["punctuation", "("],
	"ВыборкаАдреса",
	["punctuation", "."],
	"АдресЭП",
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "КонецЦикла"],
	["punctuation", ";"],

	["keyword", "Возврат"], " Адреса", ["punctuation", ";"],

	["keyword", "КонецФункции"],

	["comment", "// Получает адреса электронной почты контакта."],

	["comment", "//"],

	["comment", "// Параметры:"],

	["comment", "//  Контакт - ОпределяемыйТип.КонтактВзаимодействия - контакт, для которого получаются данные."],

	["comment", "//"],

	["comment", "// Возвращаемое значение:"],

	["comment", "//  Массив - массив структур содержащих адреса, виды и представления адресов."],

	["comment", "//"],

	["keyword", "Функция"],
	" ПолучитьАдресаЭлектроннойПочтыКонтакта",
	["punctuation", "("],
	"Контакт",
	["punctuation", ","],
	" ВключатьНезаполненныеВиды ",
	["operator", "="],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["keyword", "Экспорт"],

	["keyword", "Если"],
	["operator", "Не"],
	" ЗначениеЗаполнено",
	["punctuation", "("],
	"Контакт",
	["punctuation", ")"],
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["keyword", "Неопределено"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tЗапрос ",
	["operator", "="],
	["keyword", "Новый"],
	" Запрос",
	["punctuation", ";"],

	"\n\tИмяМетаданныхКонтакта ",
	["operator", "="],
	" Контакт",
	["punctuation", "."],
	"Метаданные",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Имя",
	["punctuation", ";"],

	["keyword", "Если"], " ВключатьНезаполненныеВиды ", ["keyword", "Тогда"],

	"\n\t\t\n\t\tЗапрос",
	["punctuation", "."],
	"Текст ",
	["operator", "="],

	["string", "\"ВЫБРАТЬ\n\t\t|\tВидыКонтактнойИнформации.Ссылка КАК Вид,\n\t\t|\tВидыКонтактнойИнформации.Наименование КАК ВидНаименование,\n\t\t|\tКонтакты.Ссылка КАК Контакт\n\t\t|ПОМЕСТИТЬ КонтактВидыКИ\n\t\t|ИЗ\n\t\t|\tСправочник.ВидыКонтактнойИнформации КАК ВидыКонтактнойИнформации,\n\t\t|\tСправочник.\""],
	["operator", "+"],
	" ИмяМетаданныхКонтакта ",
	["operator", "+"],
	["string", "\" КАК Контакты\n\t\t|ГДЕ\n\t\t|\tВидыКонтактнойИнформации.Родитель = &ГруппаВидаКонтактнойИнформации\n\t\t|\tИ Контакты.Ссылка = &Контакт\n\t\t|\tИ ВидыКонтактнойИнформации.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты)\n\t\t|;\n\t\t|\n\t\t|////////////////////////////////////////////////////////////////////////////////\n\t\t|ВЫБРАТЬ\n\t\t|\tПредставление(КонтактВидыКИ.Контакт) КАК Представление,\n\t\t|\tЕСТЬNULL(КонтактнаяИнформация.АдресЭП, \"\"\"\") КАК АдресЭП,\n\t\t|\tКонтактВидыКИ.Вид,\n\t\t|\tКонтактВидыКИ.ВидНаименование\n\t\t|ИЗ\n\t\t|\tКонтактВидыКИ КАК КонтактВидыКИ\n\t\t|\t\tЛЕВОЕ СОЕДИНЕНИЕ Справочник.\""],
	["operator", "+"],
	" ИмяМетаданныхКонтакта ",
	["operator", "+"],
	["string", "\".КонтактнаяИнформация КАК КонтактнаяИнформация\n\t\t|\t\tПО (КонтактнаяИнформация.Ссылка = КонтактВидыКИ.Контакт)\n\t\t|\t\t\tИ (КонтактнаяИнформация.Вид = КонтактВидыКИ.Вид)\""],
	["punctuation", ";"],

	"\n\t\t\n\t\tГруппаВидаКонтактнойИнформации ",
	["operator", "="],
	" УправлениеКонтактнойИнформацией",
	["punctuation", "."],
	"ВидКонтактнойИнформацииПоИмени",
	["punctuation", "("],
	["string", "\"Справочник\""],
	["operator", "+"],
	" ИмяМетаданныхКонтакта",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"ГруппаВидаКонтактнойИнформации\""],
	["punctuation", ","],
	" ГруппаВидаКонтактнойИнформации",
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Иначе"],

	"\n\t\t\n\t\tЗапрос",
	["punctuation", "."],
	"Текст ",
	["operator", "="],

	["string", "\"ВЫБРАТЬ\n\t\t|\tТаблицы.АдресЭП,\n\t\t|\tТаблицы.Вид,\n\t\t|\tТаблицы.Представление,\n\t\t|\tТаблицы.Вид.Наименование КАК ВидНаименование\n\t\t|ИЗ\n\t\t|\tСправочник.\""],
	["operator", "+"],
	" ИмяМетаданныхКонтакта ",
	["operator", "+"],
	["string", "\".КонтактнаяИнформация КАК Таблицы\n\t\t|ГДЕ\n\t\t|\tТаблицы.Ссылка = &Контакт\n\t\t|\tИ Таблицы.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты)\""],
	["punctuation", ";"],

	["keyword", "КонецЕсли"], ["punctuation", ";"],

	"\n\t\n\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"Контакт\""],
	["punctuation", ","],
	" Контакт",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\n\tВыборка ",
	["operator", "="],
	" Запрос",
	["punctuation", "."],
	["keyword", "Выполнить"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Выбрать",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Если"],
	" Выборка",
	["punctuation", "."],
	"Количество",
	["punctuation", "("],
	["punctuation", ")"],
	["operator", "="],
	["number", "0"],
	["keyword", "Тогда"],

	["keyword", "Возврат"],
	["keyword", "Новый"],
	" Массив",
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\n\tРезультат ",
	["operator", "="],
	["keyword", "Новый"],
	" Массив",
	["punctuation", ";"],

	["keyword", "Пока"],
	" Выборка",
	["punctuation", "."],
	"Следующий",
	["punctuation", "("],
	["punctuation", ")"],
	["keyword", "Цикл"],

	"\n\t\tАдрес ",
	["operator", "="],
	["keyword", "Новый"],
	" Структура",
	["punctuation", ";"],

	"\n\t\tАдрес",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"АдресЭП\""],
	["punctuation", ","],
	"         Выборка",
	["punctuation", "."],
	"АдресЭП",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tАдрес",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Вид\""],
	["punctuation", ","],
	"             Выборка",
	["punctuation", "."],
	"Вид",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tАдрес",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Представление\""],
	["punctuation", ","],
	"   Выборка",
	["punctuation", "."],
	"Представление",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tАдрес",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ВидНаименование\""],
	["punctuation", ","],
	" Выборка",
	["punctuation", "."],
	"ВидНаименование",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tРезультат",
	["punctuation", "."],
	"Добавить",
	["punctuation", "("],
	"Адрес",
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "КонецЦикла"],
	["punctuation", ";"],

	["keyword", "Возврат"], " Результат", ["punctuation", ";"],

	["keyword", "КонецФункции"],

	["keyword", "Функция"],
	" ОтправитьПолучитьПочтуПользователяВФоне",
	["punctuation", "("],
	"УникальныйИдентификатор",
	["punctuation", ")"],
	["keyword", "Экспорт"],

	"\n\t\n\tПараметрыПроцедуры ",
	["operator", "="],
	["keyword", "Новый"],
	" Структура",
	["punctuation", ";"],

	"\n\t\n\tПараметрыВыполнения ",
	["operator", "="],
	" ДлительныеОперации",
	["punctuation", "."],
	"ПараметрыВыполненияВФоне",
	["punctuation", "("],
	"УникальныйИдентификатор",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tПараметрыВыполнения",
	["punctuation", "."],
	"НаименованиеФоновогоЗадания ",
	["operator", "="],
	" НСтр",
	["punctuation", "("],
	["string", "\"ru = 'Получение и отправка электронной почты пользователя'\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\n\tДлительнаяОперация ",
	["operator", "="],
	" ДлительныеОперации",
	["punctuation", "."],
	"ВыполнитьВФоне",
	["punctuation", "("],
	["string", "\"УправлениеЭлектроннойПочтой.ОтправитьЗагрузитьПочтуПользователя\""],
	["punctuation", ","],

	"\n\t\tПараметрыПроцедуры",
	["punctuation", ","],
	"\tПараметрыВыполнения",
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Возврат"],
	" ДлительнаяОперация",
	["punctuation", ";"],

	["keyword", "КонецФункции"],

	["comment", "////////////////////////////////////////////////////////////////////////////////"],
	["comment", "//  Прочее"],

	["comment", "// Устанавливает предмет для массива взаимодействий."],

	["comment", "//"],

	["comment", "// Параметры:"],

	["comment", "//  МассивВзаимодействий - Массив - массив взаимодействий для которых будет установлен предмет."],

	["comment", "//  Предмет  - Ссылка - предмет, на который будет выполнена замена."],

	["comment", "//  ПроверятьНаличиеДругихЦепочек - Булево - если Истина, то будет выполнена замена предмета и для взаимодействий,"],

	["comment", "//                                           которые входят в  цепочки взаимодействий первым взаимодействием которых"],

	["comment", "//                                           является взаимодействие входящее в массив."],

	["comment", "//"],

	["keyword", "Процедура"],
	" УстановитьПредметДляМассиваВзаимодействий",
	["punctuation", "("],
	"МассивВзаимодействий",
	["punctuation", ","],
	" Предмет",
	["punctuation", ","],
	" ПроверятьНаличиеДругихЦепочек ",
	["operator", "="],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["keyword", "Экспорт"],

	["keyword", "Если"], " ПроверятьНаличиеДругихЦепочек ", ["keyword", "Тогда"],

	"\n\t\t\n\t\tЗапрос ",
	["operator", "="],
	["keyword", "Новый"],
	" Запрос",
	["punctuation", ";"],

	"\n\t\tЗапрос",
	["punctuation", "."],
	"Текст ",
	["operator", "="],
	["string", "\"ВЫБРАТЬ РАЗЛИЧНЫЕ\n\t\t|\tПредметыВзаимодействий.Взаимодействие КАК Ссылка\n\t\t|ИЗ\n\t\t|\tРегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыВзаимодействий\n\t\t|ГДЕ\n\t\t|\tНЕ (НЕ ПредметыВзаимодействий.Предмет В (&МассивВзаимодействий)\n\t\t|\t\t\tИ НЕ ПредметыВзаимодействий.Взаимодействие В (&МассивВзаимодействий))\""],
	["punctuation", ";"],

	"\n\t\t\n\t\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"МассивВзаимодействий\""],
	["punctuation", ","],
	" МассивВзаимодействий",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tМассивВзаимодействий ",
	["operator", "="],
	" Запрос",
	["punctuation", "."],
	["keyword", "Выполнить"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Выгрузить",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"ВыгрузитьКолонку",
	["punctuation", "("],
	["string", "\"Ссылка\""],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "КонецЕсли"], ["punctuation", ";"],

	"\n\t\n\tНачатьТранзакцию",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Попытка"],

	"\n\t\tБлокировка ",
	["operator", "="],
	["keyword", "Новый"],
	" БлокировкаДанных",
	["punctuation", ";"],

	"\n\t\tРегистрыСведений",
	["punctuation", "."],
	"ПредметыПапкиВзаимодействий",
	["punctuation", "."],
	"ЗаблокироватьПредметыПапокВзаимодействий",
	["punctuation", "("],
	"Блокировка",
	["punctuation", ","],
	" МассивВзаимодействий",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tБлокировка",
	["punctuation", "."],
	"Заблокировать",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Если"],
	" ТипЗнч",
	["punctuation", "("],
	"Предмет",
	["punctuation", ")"],
	["operator", "="],
	" Тип",
	["punctuation", "("],
	["string", "\"РегистрСведенийКлючЗаписи.СостоянияПредметовВзаимодействий\""],
	["punctuation", ")"],
	["keyword", "Тогда"],

	"\n\t\t\tПредмет ",
	["operator", "="],
	" Предмет",
	["punctuation", "."],
	"Предмет",
	["punctuation", ";"],

	["keyword", "КонецЕсли"],
	["punctuation", ";"],

	"\n\t\t\n\t\tЗапрос ",
	["operator", "="],
	["keyword", "Новый"],
	" Запрос",
	["punctuation", ";"],

	"\n\t\tЗапрос",
	["punctuation", "."],
	"Текст ",
	["operator", "="],
	["string", "\"ВЫБРАТЬ РАЗЛИЧНЫЕ\n\t\t|\tПредметыПапкиВзаимодействий.Предмет\n\t\t|ИЗ\n\t\t|\tРегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий\n\t\t|ГДЕ\n\t\t|\tПредметыПапкиВзаимодействий.Взаимодействие В(&МассивВзаимодействий)\n\t\t|\n\t\t|ОБЪЕДИНИТЬ ВСЕ\n\t\t|\n\t\t|ВЫБРАТЬ\n\t\t|\t&Предмет\""],
	["punctuation", ";"],

	"\n\t\t\n\t\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"Предмет\""],
	["punctuation", ","],
	" Предмет",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tЗапрос",
	["punctuation", "."],
	"УстановитьПараметр",
	["punctuation", "("],
	["string", "\"МассивВзаимодействий\""],
	["punctuation", ","],
	" МассивВзаимодействий",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\t\n\t\tВыборкаПредметы ",
	["operator", "="],
	" Запрос",
	["punctuation", "."],
	["keyword", "Выполнить"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", "."],
	"Выбрать",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Для"],
	["keyword", "Каждого"],
	" Взаимодействие ",
	["keyword", "Из"],
	" МассивВзаимодействий ",
	["keyword", "Цикл"],

	"\n\t\t\tВзаимодействия",
	["punctuation", "."],
	"УстановитьПредмет",
	["punctuation", "("],
	"Взаимодействие",
	["punctuation", ","],
	" Предмет",
	["punctuation", ","],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "КонецЦикла"],
	["punctuation", ";"],

	"\n\t\t\n\t\tВзаимодействия",
	["punctuation", "."],
	"РассчитатьРассмотреноПоПредметам",
	["punctuation", "("],
	"Взаимодействия",
	["punctuation", "."],
	"ТаблицаДанныхДляРасчетаРассмотрено",
	["punctuation", "("],
	"ВыборкаПредметы",
	["punctuation", ","],
	["string", "\"Предмет\""],
	["punctuation", ")"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tЗафиксироватьТранзакцию",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Исключение"],

	"\n\t\tОтменитьТранзакцию",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "ВызватьИсключение"],
	["punctuation", ";"],

	["keyword", "КонецПопытки"],
	["punctuation", ";"],

	["keyword", "КонецПроцедуры"],

	["comment", "// Преобразует письмо в двоичные данные и подготавливает к сохранению на диск."],
	["comment", "//"],
	["comment", "// Параметры:"],
	["comment", "//  Письмо                  - ДокументСсылка.ЭлектронноеПисьмоВходящее,"],
	["comment", "//                            ДокументСсылка.ЭлектронноеПисьмоИсходящее - письмо, которое подготавливается к сохранению."],
	["comment", "//  УникальныйИдентификатор - УникальныйИдентификатор - уникальный идентификатор формы, из которой была вызвана команда сохранения."],
	["comment", "//"],
	["comment", "// Возвращаемое значение:"],
	["comment", "//  Структура - структура, содержащая подготовленные данные письма."],
	["comment", "//"],
	["keyword", "Функция"],
	" ДанныеПисьмаДляСохраненияКакФайл",
	["punctuation", "("],
	"Письмо",
	["punctuation", ","],
	" УникальныйИдентификатор",
	["punctuation", ")"],
	["keyword", "Экспорт"],

	"\n\n\tДанныеФайла ",
	["operator", "="],
	" СтруктураДанныхФайла",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\n\tДанныеПисьма ",
	["operator", "="],
	" Взаимодействия",
	["punctuation", "."],
	"ИнтернетПочтовоеСообщениеИзПисьма",
	["punctuation", "("],
	"Письмо",
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Если"],
	" ДанныеПисьма ",
	["operator", "<"],
	["operator", ">"],
	["keyword", "Неопределено"],
	["keyword", "Тогда"],

	"\n\t\t\n\t\tДвоичныеДанные ",
	["operator", "="],
	" ДанныеПисьма",
	["punctuation", "."],
	"ИнтернетПочтовоеСообщение",
	["punctuation", "."],
	"ПолучитьИсходныеДанные",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tДанныеФайла",
	["punctuation", "."],
	"СсылкаНаДвоичныеДанныеФайла ",
	["operator", "="],
	" ПоместитьВоВременноеХранилище",
	["punctuation", "("],
	"ДвоичныеДанные",
	["punctuation", ","],
	" УникальныйИдентификатор",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\n\t\tДанныеФайла",
	["punctuation", "."],
	"Наименование ",
	["operator", "="],
	" Взаимодействия",
	["punctuation", "."],
	"ПредставлениеПисьма",
	["punctuation", "("],
	"ДанныеПисьма",
	["punctuation", "."],
	"ИнтернетПочтовоеСообщение",
	["punctuation", "."],
	"Тема",
	["punctuation", ","],

	"\n\t\t\tДанныеПисьма",
	["punctuation", "."],
	"ДатаПисьма",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\t\n\t\tДанныеФайла",
	["punctuation", "."],
	"Расширение  ",
	["operator", "="],
	["string", "\"eml\""],
	["punctuation", ";"],

	"\n\t\tДанныеФайла",
	["punctuation", "."],
	"ИмяФайла    ",
	["operator", "="],
	" ДанныеФайла",
	["punctuation", "."],
	"Наименование ",
	["operator", "+"],
	["string", "\".\""],
	["operator", "+"],
	" ДанныеФайла",
	["punctuation", "."],
	"Расширение",
	["punctuation", ";"],

	"\n\t\tДанныеФайла",
	["punctuation", "."],
	"Размер      ",
	["operator", "="],
	" ДвоичныеДанные",
	["punctuation", "."],
	"Размер",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tПапкаДляСохранитьКак ",
	["operator", "="],
	" ОбщегоНазначения",
	["punctuation", "."],
	"ХранилищеОбщихНастроекЗагрузить",
	["punctuation", "("],
	["string", "\"НастройкиПрограммы\""],
	["punctuation", ","],
	["string", "\"ПапкаДляСохранитьКак\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tДанныеФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ПапкаДляСохранитьКак\""],
	["punctuation", ","],
	" ПапкаДляСохранитьКак",
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tДанныеФайла",
	["punctuation", "."],
	"ДатаМодификацииУниверсальная ",
	["operator", "="],
	" ТекущаяДатаСеанса",
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\t\tДанныеФайла",
	["punctuation", "."],
	"ПолноеНаименованиеВерсии ",
	["operator", "="],
	" ДанныеФайла",
	["punctuation", "."],
	"ИмяФайла",
	["punctuation", ";"],

	["keyword", "КонецЕсли"], ["punctuation", ";"],

	["keyword", "Возврат"], " ДанныеФайла", ["punctuation", ";"],

	["keyword", "КонецФункции"],

	["keyword", "Функция"],
	" СтруктураДанныхФайла",
	["punctuation", "("],
	["punctuation", ")"],

	"\n\n\tСтруктураДанныхФайла ",
	["operator", "="],
	["keyword", "Новый"],
	" Структура",
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"СсылкаНаДвоичныеДанныеФайла\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ОтносительныйПуть\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ДатаМодификацииУниверсальная\""],
	["punctuation", ","],
	"       Дата",
	["punctuation", "("],
	["number", "1"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", ")"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ИмяФайла\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Наименование\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Расширение\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Размер\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Редактирует\""],
	["punctuation", ","],
	["keyword", "Неопределено"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ПодписанЭП\""],
	["punctuation", ","],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"Зашифрован\""],
	["punctuation", ","],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ФайлРедактируется\""],
	["punctuation", ","],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ФайлРедактируетТекущийПользователь\""],
	["punctuation", ","],
	["keyword", "Ложь"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n\tСтруктураДанныхФайла",
	["punctuation", "."],
	"Вставить",
	["punctuation", "("],
	["string", "\"ПолноеНаименованиеВерсии\""],
	["punctuation", ","],
	["string", "\"\""],
	["punctuation", ")"],
	["punctuation", ";"],

	["keyword", "Возврат"], " СтруктураДанныхФайла", ["punctuation", ";"],

	["keyword", "КонецФункции"],

	["directive", "#КонецОбласти"]
]

----------------------------------------------------