// Source: http://magma.maths.usyd.edu.au/magma/handbook/text/115#963
> D := Denominator;
> N := Numerator;
> farey := function(n)
>    f := [ RationalField() | 0, 1/n ];
>    p := 0;
>    q := 1;
>    while p/q lt 1 do
>       p := ( D(f[#f-1]) + n) div D(f[#f]) * N(f[#f])  - N(f[#f-1]);
>       q := ( D(f[#f-1]) + n) div D(f[#f]) * D(f[#f])  - D(f[#f-1]);
>       Append(~f, p/q);
>    end while;
>    return f;
> end function;
> function farey(n)
>    if n eq 1 then
>       return [RationalField() | 0, 1 ];
>    else
>       f := farey(n-1);
>       i := 0;
>       while i lt #f-1 do
>          i +:= 1;
>          if D(f[i]) + D(f[i+1]) eq n then
>             Insert( ~f, i+1, (N(f[i]) + N(f[i+1]))/(D(f[i]) + D(f[i+1])));
>          end if;
>       end while;
>       return f;
>    end if;
> end function;
> farey := func< n |
>               Sort(Setseq({ a/b : a in { 0..n }, b in { 1..n } | a le b }))>;
> farey(6);
[ 0, 1/6, 1/5, 1/4, 1/3, 2/5, 1/2, 3/5, 2/3, 3/4, 4/5, 5/6, 1 ]
----------------------------------------------------
[
	["comment", "// Source: http://magma.maths.usyd.edu.au/magma/handbook/text/115#963"],

	["punctuation", ">"],
	" D ",
	["operator", ":="],
	" Denominator",
	["punctuation", ";"],

	["punctuation", ">"],
	" N ",
	["operator", ":="],
	" Numerator",
	["punctuation", ";"],

	["punctuation", ">"],
	" farey ",
	["operator", ":="],
	["keyword", "function"],
	["punctuation", "("],
	"n",
	["punctuation", ")"],

	["punctuation", ">"],
	"    f ",
	["operator", ":="],
	["punctuation", "["],
	["function", "RationalField"],
	["punctuation", "("],
	["punctuation", ")"],
	["operator", "|"],
	["number", "0"],
	["punctuation", ","],
	["number", "1"],
	["operator", "/"],
	"n ",
	["punctuation", "]"],
	["punctuation", ";"],

	["punctuation", ">"],
	"    p ",
	["operator", ":="],
	["number", "0"],
	["punctuation", ";"],

	["punctuation", ">"],
	"    q ",
	["operator", ":="],
	["number", "1"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "while"],
	" p",
	["operator", "/"],
	"q ",
	["keyword", "lt"],
	["number", "1"],
	["keyword", "do"],

	["punctuation", ">"],
	"       p ",
	["operator", ":="],
	["punctuation", "("],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["operator", "-"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "+"],
	" n",
	["punctuation", ")"],
	["keyword", "div"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "*"],
	["function", "N"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "-"],
	["function", "N"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["operator", "-"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", ">"],
	"       q ",
	["operator", ":="],
	["punctuation", "("],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["operator", "-"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "+"],
	" n",
	["punctuation", ")"],
	["keyword", "div"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "*"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "-"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	["operator", "#"],
	"f",
	["operator", "-"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", ">"],
	["function", "Append"],
	["punctuation", "("],
	["operator", "~"],
	"f",
	["punctuation", ","],
	" p",
	["operator", "/"],
	"q",
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "end"],
	["keyword", "while"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "return"],
	" f",
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "end"],
	["keyword", "function"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "function"],
	["function", "farey"],
	["punctuation", "("],
	"n",
	["punctuation", ")"],

	["punctuation", ">"],
	["keyword", "if"],
	" n ",
	["keyword", "eq"],
	["number", "1"],
	["keyword", "then"],

	["punctuation", ">"],
	["keyword", "return"],
	["punctuation", "["],
	["function", "RationalField"],
	["punctuation", "("],
	["punctuation", ")"],
	["operator", "|"],
	["number", "0"],
	["punctuation", ","],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "else"],

	["punctuation", ">"],
	"       f ",
	["operator", ":="],
	["function", "farey"],
	["punctuation", "("],
	"n",
	["operator", "-"],
	["number", "1"],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", ">"],
	"       i ",
	["operator", ":="],
	["number", "0"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "while"],
	" i ",
	["keyword", "lt"],
	["operator", "#"],
	"f",
	["operator", "-"],
	["number", "1"],
	["keyword", "do"],

	["punctuation", ">"],
	"          i ",
	["operator", "+"],
	["operator", ":="],
	["number", "1"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "if"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	"i",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "+"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	"i",
	["operator", "+"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["keyword", "eq"],
	" n ",
	["keyword", "then"],

	["punctuation", ">"],
	["function", "Insert"],
	["punctuation", "("],
	["operator", "~"],
	"f",
	["punctuation", ","],
	" i",
	["operator", "+"],
	["number", "1"],
	["punctuation", ","],
	["punctuation", "("],
	["function", "N"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	"i",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "+"],
	["function", "N"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	"i",
	["operator", "+"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["punctuation", ")"],
	["operator", "/"],
	["punctuation", "("],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	"i",
	["punctuation", "]"],
	["punctuation", ")"],
	["operator", "+"],
	["function", "D"],
	["punctuation", "("],
	"f",
	["punctuation", "["],
	"i",
	["operator", "+"],
	["number", "1"],
	["punctuation", "]"],
	["punctuation", ")"],
	["punctuation", ")"],
	["punctuation", ")"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "end"],
	["keyword", "if"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "end"],
	["keyword", "while"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "return"],
	" f",
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "end"],
	["keyword", "if"],
	["punctuation", ";"],

	["punctuation", ">"],
	["keyword", "end"],
	["keyword", "function"],
	["punctuation", ";"],

	["punctuation", ">"],
	" farey ",
	["operator", ":="],
	["generator", "func"],
	["punctuation", "<"],
	" n ",
	["operator", "|"],

	["punctuation", ">"],
	["function", "Sort"],
	["punctuation", "("],
	["function", "Setseq"],
	["punctuation", "("],
	["punctuation", "{"],
	" a",
	["operator", "/"],
	"b ",
	["punctuation", ":"],
	" a ",
	["keyword", "in"],
	["punctuation", "{"],
	["number", "0"],
	["operator", ".."],
	"n ",
	["punctuation", "}"],
	["punctuation", ","],
	" b ",
	["keyword", "in"],
	["punctuation", "{"],
	["number", "1"],
	["operator", ".."],
	"n ",
	["punctuation", "}"],
	["operator", "|"],
	" a ",
	["keyword", "le"],
	" b ",
	["punctuation", "}"],
	["punctuation", ")"],
	["punctuation", ")"],
	["punctuation", ">"],
	["punctuation", ";"],

	["punctuation", ">"],
	["function", "farey"],
	["punctuation", "("],
	["number", "6"],
	["punctuation", ")"],
	["punctuation", ";"],

	["output", "[ 0, 1/6, 1/5, 1/4, 1/3, 2/5, 1/2, 3/5, 2/3, 3/4, 4/5, 5/6, 1 ]"]
]

----------------------------------------------------