queens n       = catch reverse (search n 1 []) with
  search n i p = throw p if i>n;
               = void [search n (i+1) ((i,j):p) | j = 1..n; safe (i,j) p];
  safe (i,j) p = ~any (check (i,j)) p;
  check (i1,j1) (i2,j2)
               = i1==i2 || j1==j2 || i1+j1==i2+j2 || i1-j1==i2-j2;
end;
----------------------------------------------------
[
	"queens n       ",
	["operator", "="],
	["keyword", "catch"],
	["function", "reverse"],
	["punctuation", "("],
	"search n ",
	["number", "1"],
	["punctuation", "["],
	["punctuation", "]"],
	["punctuation", ")"],
	["keyword", "with"],

	"\n  search n i p ",
	["operator", "="],
	["keyword", "throw"],
	" p ",
	["keyword", "if"],
	" i",
	["operator", ">"],
	"n",
	["punctuation", ";"],

	["operator", "="],
	["function", "void"],
	["punctuation", "["],
	"search n ",
	["punctuation", "("],
	"i",
	["operator", "+"],
	["number", "1"],
	["punctuation", ")"],
	["punctuation", "("],
	["punctuation", "("],
	"i",
	["operator", ","],
	"j",
	["punctuation", ")"],
	["operator", ":"],
	"p",
	["punctuation", ")"],
	["operator", "|"],
	" j ",
	["operator", "="],
	["number", "1"],
	["operator", ".."],
	"n",
	["punctuation", ";"],
	" safe ",
	["punctuation", "("],
	"i",
	["operator", ","],
	"j",
	["punctuation", ")"],
	" p",
	["punctuation", "]"],
	["punctuation", ";"],

	"\n  safe ",
	["punctuation", "("],
	"i",
	["operator", ","],
	"j",
	["punctuation", ")"],
	" p ",
	["operator", "="],
	["operator", "~"],
	["function", "any"],
	["punctuation", "("],
	"check ",
	["punctuation", "("],
	"i",
	["operator", ","],
	"j",
	["punctuation", ")"],
	["punctuation", ")"],
	" p",
	["punctuation", ";"],

	"\n  check ",
	["punctuation", "("],
	"i1",
	["operator", ","],
	"j1",
	["punctuation", ")"],
	["punctuation", "("],
	"i2",
	["operator", ","],
	"j2",
	["punctuation", ")"],

	["operator", "="],
	" i1",
	["operator", "=="],
	"i2 ",
	["operator", "||"],
	" j1",
	["operator", "=="],
	"j2 ",
	["operator", "||"],
	" i1",
	["operator", "+"],
	"j1",
	["operator", "=="],
	"i2",
	["operator", "+"],
	"j2 ",
	["operator", "||"],
	" i1",
	["operator", "-"],
	"j1",
	["operator", "=="],
	"i2",
	["operator", "-"],
	"j2",
	["punctuation", ";"],

	["keyword", "end"],
	["punctuation", ";"]
]

----------------------------------------------------