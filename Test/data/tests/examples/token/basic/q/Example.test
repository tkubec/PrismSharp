/ Example from http://code.kx.com/wiki/Cookbook/CorporateActions
getCAs:{[caTypes]
    / handles multiplie corporate actions on one date
    t:0!select factor:prd factor by date-1,sym from ca where caType in caTypes;
    t,:update date:1901.01.01,factor:1.0 from ([]sym:distinct t`sym);
    t:`date xasc t;
    t:update factor:reverse prds reverse 1 rotate factor by sym from t;
    :update `g#sym from 0!t;
  };

adjust:{[t;caTypes]
    t:0!t;
    factors:enlist 1.0^aj[`sym`date;([] date:t`date;sym:t`sym);getCAs caTypes]`factor;
    mc:c where (lower c:cols t) like "*price"; / find columns to multiply
    dc:c where lower[c] like "*size"; / find columns to divide
    :![t;();0b;(mc,dc)!((*),/:mc,\:factors),((%),/:dc,\:factors)]; / multiply or divide out the columns
  };

/ get the adjustment factors considering all corporate actions
getCAs exec distinct caType from ca

adjust[t;`dividend] / adjust trades for dividends only
----------------------------------------------------
[
	["comment", "/ Example from http://code.kx.com/wiki/Cookbook/CorporateActions"],

	"\ngetCAs",
	["verb", ":"],
	["punctuation", "{"],
	["punctuation", "["],
	"caTypes",
	["punctuation", "]"],

	["comment", "/ handles multiplie corporate actions on one date"],

	"\n    t",
	["verb", ":"],
	["number", "0"],
	["verb", "!"],
	["keyword", "select"],
	" factor",
	["verb", ":"],
	["keyword", "prd"],
	" factor ",
	["keyword", "by"],
	" date",
	["verb", "-"],
	["number", "1"],
	["verb", ","],
	"sym ",
	["keyword", "from"],
	" ca ",
	["keyword", "where"],
	" caType ",
	["keyword", "in"],
	" caTypes",
	["punctuation", ";"],

	"\n    t",
	["verb", ",:"],
	["keyword", "update"],
	" date",
	["verb", ":"],
	["datetime", "1901.01.01"],
	["verb", ","],
	"factor",
	["verb", ":"],
	["number", "1.0"],
	["keyword", "from"],
	["punctuation", "("],
	["punctuation", "["],
	["punctuation", "]"],
	"sym",
	["verb", ":"],
	["keyword", "distinct"],
	" t",
	["symbol", "`sym"],
	["punctuation", ")"],
	["punctuation", ";"],

	"\n    t",
	["verb", ":"],
	["symbol", "`date"],
	["keyword", "xasc"],
	" t",
	["punctuation", ";"],

	"\n    t",
	["verb", ":"],
	["keyword", "update"],
	" factor",
	["verb", ":"],
	["keyword", "reverse"],
	["keyword", "prds"],
	["keyword", "reverse"],
	["number", "1"],
	["keyword", "rotate"],
	" factor ",
	["keyword", "by"],
	" sym ",
	["keyword", "from"],
	" t",
	["punctuation", ";"],

	["verb", ":"],
	["keyword", "update"],
	["symbol", "`g"],
	["verb", "#"],
	"sym ",
	["keyword", "from"],
	["number", "0"],
	["verb", "!"],
	"t",
	["punctuation", ";"],

	["punctuation", "}"],
	["punctuation", ";"],

	"\n\nadjust",
	["verb", ":"],
	["punctuation", "{"],
	["punctuation", "["],
	"t",
	["punctuation", ";"],
	"caTypes",
	["punctuation", "]"],

	"\n    t",
	["verb", ":"],
	["number", "0"],
	["verb", "!"],
	"t",
	["punctuation", ";"],

	"\n    factors",
	["verb", ":"],
	["keyword", "enlist"],
	["number", "1.0"],
	["verb", "^"],
	["keyword", "aj"],
	["punctuation", "["],
	["symbol", "`sym"],
	["symbol", "`date"],
	["punctuation", ";"],
	["punctuation", "("],
	["punctuation", "["],
	["punctuation", "]"],
	" date",
	["verb", ":"],
	"t",
	["symbol", "`date"],
	["punctuation", ";"],
	"sym",
	["verb", ":"],
	"t",
	["symbol", "`sym"],
	["punctuation", ")"],
	["punctuation", ";"],
	"getCAs caTypes",
	["punctuation", "]"],
	["symbol", "`factor"],
	["punctuation", ";"],

	"\n    mc",
	["verb", ":"],
	"c ",
	["keyword", "where"],
	["punctuation", "("],
	["keyword", "lower"],
	" c",
	["verb", ":"],
	["keyword", "cols"],
	" t",
	["punctuation", ")"],
	["keyword", "like"],
	["string", "\"*price\""],
	["punctuation", ";"],
	["comment", "/ find columns to multiply"],

	"\n    dc",
	["verb", ":"],
	"c ",
	["keyword", "where"],
	["keyword", "lower"],
	["punctuation", "["],
	"c",
	["punctuation", "]"],
	["keyword", "like"],
	["string", "\"*size\""],
	["punctuation", ";"],
	["comment", "/ find columns to divide"],

	["verb", ":"],
	["verb", "!"],
	["punctuation", "["],
	"t",
	["punctuation", ";"],
	["punctuation", "("],
	["punctuation", ")"],
	["punctuation", ";"],
	["number", "0b"],
	["punctuation", ";"],
	["punctuation", "("],
	"mc",
	["verb", ","],
	"dc",
	["punctuation", ")"],
	["verb", "!"],
	["punctuation", "("],
	["punctuation", "("],
	["verb", "*"],
	["punctuation", ")"],
	["verb", ","],
	["adverb", "/:"],
	"mc",
	["verb", ","],
	["adverb", "\\:"],
	"factors",
	["punctuation", ")"],
	["verb", ","],
	["punctuation", "("],
	["punctuation", "("],
	["verb", "%"],
	["punctuation", ")"],
	["verb", ","],
	["adverb", "/:"],
	"dc",
	["verb", ","],
	["adverb", "\\:"],
	"factors",
	["punctuation", ")"],
	["punctuation", "]"],
	["punctuation", ";"],
	["comment", "/ multiply or divide out the columns"],

	["punctuation", "}"],
	["punctuation", ";"],

	["comment", "/ get the adjustment factors considering all corporate actions"],

	"\ngetCAs ",
	["keyword", "exec"],
	["keyword", "distinct"],
	" caType ",
	["keyword", "from"],
	" ca\n\nadjust",
	["punctuation", "["],
	"t",
	["punctuation", ";"],
	["symbol", "`dividend"],
	["punctuation", "]"],
	["comment", "/ adjust trades for dividends only"]
]

----------------------------------------------------